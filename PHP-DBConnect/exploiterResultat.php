<?php
    include("connectDBclass.inc.php");
    include("recupererResultat.php");
    

    //On compte les kilomètres parcourus

    $totalKm = 0;

    foreach($trajets as $trajet){
        $totalKm += $trajet->kilometrage;
    };    

    //On définit les deux fonctions que l'on va créer :
    // compter_occurences qui permet de compter le nombre de fois où l'on retrouve les différents ID en fonction des tables
    // afficher_resultat qui va permettre de créer un affichage pour la répartition en pourcentage des différents ID en fonction des tables et afficher une barre de visualisation

    function compter_occurences($trajets, $colonne, $valeurs){
        $compte = array_fill_keys($valeurs, 0);
        foreach($trajets as $trajet){
            $elements = explode(',', $trajet->$colonne); //permet de gérer les tables  où il y a un tableau de résultats car plusieurs résultats sont selectionnables
            foreach($elements as $element){
                if (in_array($element, $valeurs)){
                    $compte[$element]++;
                }
            }
        }
        return $compte ;
    };

    function afficher_resultat($occurences){ //On utilise le paramètre d'occurences calculé plus haut pour faire une fonction qui affiche les résultats automatiquement !
        $occurencesTotal = array_sum($occurences); //pour définir ce qui est 100% des expériences
        $remplissage = []; //réinitialiser le tableau de remplissage à chaque lancement de la fonction

        foreach ($occurences as $valeur => $compte) {
            $remplissage[$valeur]=($compte/$occurencesTotal)*100; //Permet de définir la valeur des occurences de chaque condition (en %) 
        }

        $positionnementCompteur = 0; //Pour définir où la condition doit se positionner. Peut être que ce serait mieux de la définir au niveau class CSS grâce à la classe valeur{$valeur} ?
        $remplissageHtml = ''; //Variable qui va stocker les résultats de la boucle foreach

        foreach ($remplissage as $valeur => $pourcentage) {
            $positionnement = $positionnementCompteur; //permet le décalage à gauche de chaque condition
            $positionnementCompteur += $pourcentage;
            if($pourcentage > 0){ //on veut afficher seulement les conditions qui ont des trajets
                $remplissageHtml .= "<div class='remplissage meteo valeur{$valeur}' style='width: {$pourcentage}%; left: {$positionnement}%;'><h1>{$occurences[$valeur]}</h1></div>";
            }        
        } 

        return $remplissageHtml;
    }

    //On compte les occurences de chaque condition METEO

    $valeursMeteo = [1,2,3,4,5,6,7,8];

    $occurencesMeteo = compter_occurences($trajets, 'meteo', $valeursMeteo);

    //On compte les occurences de chaque condition TYPE DE TRAFIC

    $valeursTrafic = [1,2,3,4];

    $occurencesTrafic = compter_occurences($trajets, 'trafic', $valeursTrafic);

    //On compte les occurences de chaque TYPE DE ROUTE

    $valeursTypeRoute = [1,2,3,4,5];

    $occurencesTypeRoute = compter_occurences($trajets, 'typeRoute', $valeursTypeRoute);

    //On compte les occurences de chaque MANOEUVRE

    $valeursManoeuvre = [1,2,3];

    $occurencesManoeuvre = compter_occurences($trajets, 'manoeuvres', $valeursManoeuvre);

    //On affiche chaque résultat !

    $afficherMeteo = afficher_resultat($occurencesMeteo);

    $afficherTrafic = afficher_resultat($occurencesTrafic);

    $afficherTypeRoute = afficher_resultat($occurencesTypeRoute);

    $afficherManoeuvre = afficher_resultat($occurencesManoeuvre);

?>

<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        .container {
            width: 500px;
            height: 30px;
            position: relative;
            background-color: black;
            z-index: 0;
            margin-bottom: 10px;
        }

        .remplissage {
            height: 100%;
            position: absolute;
            z-index: 1;
        }

        .valeur1 {
            background-color: green;
        }

        .valeur2 {
            background-color: red;
        }

        .valeur3 {
            background-color: blue;
        }

        .valeur4 {
            background-color: yellow;
        }

        .valeur5 {
            background-color: purple;
        }

        .valeur6 {
            background-color: orange;
        }

        .valeur7 {
            background-color: pink;
        }

        .valeur8 {
            background-color: brown;
        }
    </style>
</head>
<body>
<div class="container">
    <?php echo $afficherMeteo; ?>
</div>
<div class="container">
    <?php echo $afficherTrafic; ?>
</div>
<div class="container">
    <?php echo $afficherTypeRoute; ?>
</div>
<div class="container">
    <?php echo $afficherManoeuvre; ?>
</div>
</body>
</html>